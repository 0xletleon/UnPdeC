<!DOCTYPE html>
<html>

<head>
    <title>IEEE754 æµ®ç‚¹æ•°è®¡ç®—å™¨</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .title {
            font-size: 70px;
            font-weight: 100;
            margin: 3px;
            line-height: 100px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .input-group {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            padding: 5px;
        }

        input {
            padding: 5px;
            margin-right: 5px;
            flex: 10;
            font-size: 20px;
        }

        select {
            flex: 2;
            font-size: 20px;
            text-align: center;
            margin: 0 5px;
        }

        button {
            flex: 3;
            font-size: 20px;
            text-align: center;
            margin: 0 5px;
        }

        .result {
            margin: 5px;
        }

        #groupInfo {
            font-size: 30px;
            font-weight: bold;
            color: #ef8738;
            line-height: 60px;
            padding-left: 10px;
            background-color: #f8f6d9;
            border-radius: 8px;
        }

        .float-value {
            font-size: 20px;
            padding: 10px;
            background-color: #fafafa;
            border-radius: 8px;
        }

        .line-number {
            font-size: 30px;
            font-weight: bold;
            color: #f56969;
            user-select: none;
        }

        .error {
            color: red;
            margin: 5px 0;
        }

        #backToTopBtn {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 99;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 10px;
            border-radius: 30px;
        }

        #backToTopBtn:hover {
            background-color: #fa8a8a;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2 class="title">IEEE754 æµ®ç‚¹æ•°è®¡ç®—å™¨</h2>
        <div class="input-group">
            <input type="text" id="hexInput" placeholder="è¾“å…¥16è¿›åˆ¶å€¼(å¦‚: E49E863E BB08233E 8FC2F53C)"
                oninput="convertMultiple()">
            <select id="endian" onchange="convertMultiple()">
                <option value="little">å°ç«¯</option>
                <option value="big">å¤§ç«¯</option>
            </select>
            <select id="groupSize" onchange="convertMultiple()">
                <option value="24">0x18å­—èŠ‚/ç»„</option>
                <option value="28">0x1cå­—èŠ‚/ç»„</option>
                <option value="52">0x34å­—èŠ‚/ç»„</option>
                <option value="64">0x40å­—èŠ‚/ç»„</option>
            </select>
            <button onclick="copyResults()">å¤åˆ¶ç»“æœ</button>
            <button onclick="clearCache()">æ¸…é™¤ç¼“å­˜</button>
        </div>
        <div id="error" class="error"></div>
        <div id="groupInfo" class="result"></div>
        <div id="multipleResult" class="result"></div>
    </div>

    <button id="backToTopBtn">ğŸš€</button>

    <script>
        window.onload = function () {
            // è¯»å–æœ¬åœ°ç¼“å­˜
            var hexInput = localStorage.getItem('hexInput');
            if (hexInput?.length) {
                convertMultiple(hexInput);
            }
        }

        // åˆ¤æ–­æ˜¯å¦ä¸ºæœ‰æ•ˆçš„åå…­è¿›åˆ¶å€¼
        function isValidHex(hex) {
            return /^[0-9a-fA-F]+$/.test(hex);
        }

        // å°†æµ®ç‚¹æ•°è½¬æ¢ä¸ºåå…­è¿›åˆ¶
        function hexToFloat(hex, endian) {
            hex = hex.replace(/^0x/, '');
            while (hex.length < 8) hex = '0' + hex;
            var intArray = [];

            if (endian === 'little') {
                hex = hex.match(/.{2}/g)?.reverse()?.join('');
            }

            var int = parseInt(hex, 16);
            var float32 = new Float32Array(1);
            var int32 = new Int32Array(float32.buffer);
            int32[0] = int;
            var floatNum = float32[0].toString().split('.');
            return floatNum[0] + '.' + (floatNum[1] ? floatNum[1].slice(0, 8) : '00000000');
        }

        // å°†åå…­è¿›åˆ¶è½¬æ¢ä¸ºæµ®ç‚¹æ•°
        function convertMultiple(localHex) {
            var hexInput = ""
            if (localHex?.length) {
                hexInput = localHex;
                document.getElementById('hexInput').value = hexInput;
            } else {
                hexInput = document.getElementById('hexInput').value;
            }
            // ä¿å­˜ç¼“å­˜
            saveCache(hexInput);
            var endian = document.getElementById('endian').value;
            var groupSizeBytes = parseInt(document.getElementById('groupSize').value); // è·å–æ¯è¡Œçš„å­—èŠ‚æ•°
            var groupSize = groupSizeBytes / 4; // æ¯è¡Œæ˜¾ç¤ºçš„æ•°æ®ä¸ªæ•°ï¼ˆæ¯ä¸ªæ•°æ®å  4 å­—èŠ‚ï¼‰
            hexInput = hexInput.replace(/\s+/g, '');
            var hexValues = [];
            var error = false;
            for (var i = 0; i < hexInput.length; i += 8) {
                var hex = hexInput.substr(i, 8);
                if (!isValidHex(hex)) {
                    document.getElementById('error').textContent = 'è¾“å…¥é”™è¯¯ï¼šå­˜åœ¨éæ³•çš„åå…­è¿›åˆ¶å€¼ã€‚';
                    error = true;
                    break;
                }
                hexValues.push(hex);
            }
            if (error) {
                document.getElementById('multipleResult').innerHTML = '';
                return;
            }
            document.getElementById('error').textContent = '';
            var results = [];
            var groupCount = 1;
            for (var i = 0; i < hexValues.length; i += groupSize) {
                var group = hexValues.slice(i, i + groupSize);
                var groupResult = group.map(hex => {
                    var result = hexToFloat(hex, endian);
                    return `${hex} &emsp; -> &emsp; ${result}`;
                }).join('<br>');
                if (i >= groupSize * groupCount) {
                    groupCount++;
                }
                results.push(`<div class="float-value"><div class="line-number">${groupCount}ç»„</div>${groupResult}</div> <br> `);
            }

            // è¾“å‡ºåˆ°é¡µé¢
            document.getElementById('multipleResult').innerHTML = results.join('');
            document.getElementById('groupInfo').innerHTML = `å…± ${hexValues.length}è¡Œ ${groupCount}ç»„`;
        }

        // ä¿å­˜ç¼“å­˜
        function saveCache(hexInput) {
            // ä¿å­˜ hexInput åˆ° localStorage
            localStorage.setItem('hexInput', hexInput);
        }

        // æ¸…é™¤ç¼“å­˜
        function clearCache() {
            localStorage.removeItem('hexInput');
        }

        // å¤åˆ¶ç»“æœ
        function copyResults() {
            var resultDiv = document.getElementById('multipleResult');
            var textToCopy = resultDiv.innerText;
            var textArea = document.createElement("textarea");
            textArea.value = textToCopy;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
        }

        // Back To Top Button
        let backToTopBtn = document.getElementById("backToTopBtn");

        // ç›‘å¬é¡µé¢æ»šåŠ¨äº‹ä»¶
        window.onscroll = function () {
            scrollFunction();
        };

        // æ ¹æ®æ»šåŠ¨ä½ç½®æ˜¾ç¤ºæˆ–éšè—æŒ‰é’®
        function scrollFunction() {
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                backToTopBtn.style.display = "block";
            } else {
                backToTopBtn.style.display = "none";
            }
        }

        // ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œå¹³æ»‘æ»šåŠ¨å›åˆ°é¡¶éƒ¨
        backToTopBtn.addEventListener("click", function () {
            window.scrollTo({
                top: 0,
                behavior: "smooth" // å¹³æ»‘æ»šåŠ¨æ•ˆæœ
            });
        });
    </script>
</body>

</html>